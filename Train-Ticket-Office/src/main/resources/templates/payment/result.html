<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Kết quả thanh toán</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">
    <h2 class="mb-4">Kết quả thanh toán</h2>

    <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

    <div th:if="${payment}" class="card shadow-sm">
        <div class="card-body">
            <div class="alert mb-3"
                 th:classappend="${success} ? ' alert-success' : ' alert-warning'"
                 th:text="${message}"></div>
            <p class="mb-1"><strong>Mã giao dịch:</strong> <span th:text="${payment.transactionRef}"></span></p>
            <p class="mb-1"><strong>Mã phản hồi (VNPay):</strong> <span th:text="${payment.responseCode}"></span></p>
            <p class="mb-1"><strong>Ngân hàng:</strong> <span th:text="${payment.bankCode}"></span></p>
            <p class="mb-1"><strong>Trạng thái:</strong>
                <span th:if="${payment.status.name() == 'SUCCESS'}" class="badge bg-success">Thành công</span>
                <span th:if="${payment.status.name() == 'FAILED'}" class="badge bg-danger">Thất bại</span>
                <span th:if="${payment.status.name() == 'PENDING'}" class="badge bg-warning text-dark">Đang xử lý</span>
            </p>
            <div th:if="${booking}" class="mt-3">
                <h5>Đặt vé liên quan</h5>
                <p class="mb-1"><strong>Mã đặt chỗ:</strong> <span th:text="${booking.bookingId}"></span></p>
                <p class="mb-1"><strong>Khách hàng:</strong> <span th:text="${booking.passengerName}"></span></p>
                <p class="mb-1"><strong>Chuyến đi:</strong>
                    <span th:text="${booking.trip.departureStation + ' → ' + booking.trip.arrivalStation}"></span>
                </p>
                <p class="mb-1"><strong>Trạng thái đặt vé:</strong>
                    <span th:if="${booking.status.name() == 'PAID'}" class="badge bg-success">Đã thanh toán</span>
                    <span th:if="${booking.status.name() == 'BOOKED'}" class="badge bg-warning text-dark">Chờ thanh toán</span>
                    <span th:if="${booking.status.name() == 'CANCELLED'}" class="badge bg-secondary">Đã hủy</span>
                </p>
            </div>
        </div>
    </div>

    <div class="mt-4">
        <a th:href="@{/bookings}" class="btn btn-primary">Quay về danh sách đặt vé</a>
    </div>
</div>
</body>
</html>