<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragments/_customer_layout}">
<head>
    <title>Tất Cả Chuyến Sắp Diễn Ra</title>
</head>
<body>
<div layout:fragment="content">

    <h2 class="page-title">
        Tất Cả Chuyến Sắp Diễn Ra
    </h2>

    <div th:if="${#lists.isEmpty(availableTrips)}" class="alert alert-warning" role="alert">
        Hiện tại không có chuyến tàu nào sắp diễn ra.
    </div>

    <div th:if="${not #lists.isEmpty(availableTrips)}">
        <table class="table table-hover">
            <thead>
            <tr>
                <th>Tuyến</th> <th>Mã Tàu</th>
                <th>Giờ Đi</th>
                <th>Giờ Đến</th>
                <th>Ghế Trống</th>
                <th>Giá từ (VNĐ)</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="trip : ${availableTrips}">

                <td class="align-middle">
                    <strong th:text="${trip.route.code}">HN-HCM</strong>
                </td>

                <td class="align-middle">
                    <strong th:text="${trip.train.code}">SE1</strong>
                </td>

                <td class="align-middle">
                    <span th:text="${#temporals.format(trip.departureTime, 'dd/MM/yyyy HH:mm')}"></span>
                </td>

                <td class="align-middle">
                    <span th:text="${#temporals.format(trip.arrivalTime, 'dd/MM/yyyy HH:mm')}"></span>
                </td>

                <td class="align-middle">
                    <span th:text="|VIP: ${availableVipCounts[trip.tripId]}|"
                          class="badge bg-warning text-dark me-1"></span>
                    <span th:text="|Thường: ${availableNormalCounts[trip.tripId]}|"
                          class="badge bg-light text-dark"></span>
                </td>

                <td class="align-middle">
                    <strong th:text="${#numbers.formatDecimal(tripMinPrices[trip.tripId], 0, 'COMMA', 0, 'POINT')}"></strong>
                </td>

                <td class="text-end">
                    <th:block th:with="totalAvailable=${availableVipCounts[trip.tripId] + availableNormalCounts[trip.tripId]}">
                        <a th:href="@{/bookings/new(tripId=${trip.tripId})}"
                           class="btn btn-primary"
                           th:classappend="${totalAvailable == 0} ? 'disabled' : ''">

                            <span th:if="${totalAvailable > 0}">Đặt Vé</span>
                            <span th:if="${totalAvailable == 0}">Hết Vé</span>
                            <i class="bi bi-chevron-right" th:if="${totalAvailable > 0}"></i>
                        </a>
                    </th:block>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <a th:href="@{/}" class="btn btn-secondary mt-3">
        <i class="bi bi-arrow-left"></i> Quay lại Tìm kiếm
    </a>

</div>
</body>
</html>